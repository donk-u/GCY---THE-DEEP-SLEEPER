// è‡ªå®šä¹‰åŸŸåé…ç½®è„šæœ¬
const fs = require('fs');
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

console.log('ğŸŒ CloudBase è‡ªå®šä¹‰åŸŸåé…ç½®å‘å¯¼\n');

function askQuestion(question) {
    return new Promise(resolve => {
        rl.question(question, resolve);
    });
}

async function setupDomain() {
    try {
        console.log('ğŸ“‹ è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š\n');
        
        const domain = await askQuestion('ğŸ”— è¯·è¾“å…¥ä½ çš„åŸŸåï¼ˆå¦‚ï¼šyour-domain.comï¼‰: ');
        const subdomain = await askQuestion('ğŸ“ å­åŸŸåï¼ˆå¯é€‰ï¼Œç•™ç©ºåˆ™ä½¿ç”¨ä¸»åŸŸåï¼‰: ');
        
        const fullDomain = subdomain ? `${subdomain}.${domain}` : domain;
        
        console.log('\nğŸ”§ ç”Ÿæˆé…ç½®æ–‡ä»¶...\n');
        
        // ç”Ÿæˆ cloudbaserc.json
        const config = {
            envId: "cloud1-3gc4eoi9a5139d21",
            functionRoot: "./cloudfunctions",
            storageRoot: "./storage",
            dbRoot: "./db",
            region: "ap-shanghai"
        };
        
        fs.writeFileSync('cloudbaserc.json', JSON.stringify(config, null, 2));
        
        // ç”ŸæˆåŸŸåé…ç½®æ–‡æ¡£
        const domainConfig = `# åŸŸåé…ç½®æŒ‡å—

## ğŸŒ åŸŸåä¿¡æ¯
- **å®Œæ•´åŸŸå**: ${fullDomain}
- **CloudBase ç¯å¢ƒ**: cloud1-3gc4eoi9a5139d21
- **ç›®æ ‡åœ°å€**: cloud1-3gc4eoi9a5139d21-1385724839.tcloudbaseapp.com

## ğŸ“ DNS é…ç½®

### CloudBase æ§åˆ¶å°é…ç½®
1. è®¿é—®: https://console.cloud.tencent.com/tcb
2. é€‰æ‹©ç¯å¢ƒ: cloud1-3gc4eoi9a5139d21
3. è¿›å…¥: é™æ€ç½‘ç«™æ‰˜ç®¡ â†’ åŸŸåç®¡ç†
4. æ·»åŠ åŸŸå: ${fullDomain}
5. å¼€å¯: HTTP å¼ºåˆ¶è·³è½¬ HTTPS

### åŸŸåè§£æé…ç½®
åœ¨ä½ çš„åŸŸåæœåŠ¡å•†å¤„æ·»åŠ ä»¥ä¸‹è§£æï¼š

\`\`\`
è®°å½•ç±»å‹: CNAME
ä¸»æœºè®°å½•: ${subdomain || '@'}
è®°å½•å€¼: cloud1-3gc4eoi9a5139d21-1385724839.tcloudbaseapp.com
TTL: 600
\`\`\`

## â° ç­‰å¾…æ—¶é—´
- DNS è§£æ: 5-30 åˆ†é’Ÿ
- SSL è¯ä¹¦: è‡ªåŠ¨é…ç½®
- å…¨çƒç”Ÿæ•ˆ: æœ€é•¿ 24 å°æ—¶

## âœ… éªŒè¯æ–¹æ³•
1. æµè§ˆå™¨è®¿é—®: https://${fullDomain}
2. æ£€æŸ¥ HTTP çŠ¶æ€ç : 200
3. æ£€æŸ¥ SSL è¯ä¹¦: æœ‰æ•ˆ

## ğŸš¨ æ³¨æ„äº‹é¡¹
- ç¡®ä¿åŸŸåå·²å¤‡æ¡ˆï¼ˆå¦‚éœ€ï¼‰
- ä¸è¦åŒæ—¶é…ç½® A è®°å½•å’Œ CNAME è®°å½•
- é…ç½®ç”Ÿæ•ˆå‰ä¸è¦åˆ é™¤åŸè§£æ
`;

        fs.writeFileSync('åŸŸåé…ç½®æŒ‡å—.md', domainConfig);
        
        console.log('âœ… é…ç½®å®Œæˆï¼\n');
        console.log('ğŸ“„ ç”Ÿæˆçš„æ–‡ä»¶ï¼š');
        console.log('   - cloudbaserc.json (CloudBase é…ç½®)');
        console.log('   - åŸŸåé…ç½®æŒ‡å—.md (è¯¦ç»†é…ç½®æ­¥éª¤)');
        console.log('\nğŸ”§ ä¸‹ä¸€æ­¥æ“ä½œï¼š');
        console.log('   1. æŒ‰ç…§åŸŸåé…ç½®æŒ‡å—.md çš„æ­¥éª¤æ“ä½œ');
        console.log('   2. åœ¨ CloudBase æ§åˆ¶å°æ·»åŠ åŸŸå');
        console.log('   3. é…ç½® DNS è§£æ');
        console.log('   4. ç­‰å¾…é…ç½®ç”Ÿæ•ˆ');
        console.log('\nğŸŒ é…ç½®å®Œæˆåè®¿é—®åœ°å€ï¼š');
        console.log(`   https://${fullDomain}`);
        
    } catch (error) {
        console.error('âŒ é…ç½®å¤±è´¥:', error.message);
    } finally {
        rl.close();
    }
}

setupDomain();